<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURÈS Médical · Installation Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Favicon -->
  <link rel="icon" href="favicon.ico" type="image/x-icon" />

  <!-- Leaflet + MarkerCluster -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f6f8;
      margin: 0;
      padding: 0;
    }

    /* HEADER */
    header {
      background-color: #004165;
      color: white;
      padding: 15px 20px;
      display: flex;
      align-items: center;
      position: relative;
    }

    header img {
      height: 32px;
    }

    header h1 {
      margin-left: 15px;
      font-size: 22px;
      font-weight: 700;
    }

    /* SMALL logout button (square) */
    #logoutBtn {
      position: absolute;
      right: 10px;
      top: 10px;
      background: #d9534f;
      color: white;
      border: none;
      width: 35px;
      height: 35px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
    }

    #logoutBtn:hover {
      background: #c9302c;
    }

    /* LOGIN */
    #login-container {
      max-width: 400px;
      margin: 100px auto;
      background: white;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }

    select, input {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    button {
      margin-top: 20px;
      background-color: #004165;
      color: white;
      border: none;
      padding: 12px;
      width: 100%;
      font-size: 1.1em;
      border-radius: 6px;
      cursor: pointer;
    }

    #map {
      height: 520px;
      border-radius: 6px;
      margin-top: 20px;
    }

    .container {
      max-width: 1000px;
      margin: 20px auto;
    }

    .entry-list {
      background: white;
      padding: 15px;
      border-radius: 6px;
      margin-top: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .entry-item {
      padding: 8px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      font-size: 0.95em;
    }

    .delete-btn {
      background: #d9534f;
      color: white;
      border: none;
      height: 20px;
      width: 100px;
      padding: 5px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8em;
    }
  </style>
</head>
<body>

<!-- LOGIN PAGE -->
<div id="login-container">
  <h2 style="text-align:center;color:#004165;">Login</h2>
  <form id="loginForm">
    <label>Username:</label>
    <input id="username" required />
    <label>Password:</label>
    <input id="password" type="password" required />
    <button type="submit">Login</button>
  </form>
</div>

<!-- APP -->
<div id="app" style="display:none;">
  <header>
    <img src="auresmedical.png" alt="logo" onerror="this.style.display='none'">
    <h1>AURÈS Médical — Installation Tracker</h1>
    <button id="logoutBtn">X</button>
  </header>

  <div class="container">
    <form id="entryForm">

      <label>Brand:</label>
      <select id="brand" required>
        <option value="">Select Brand</option>
        <option>Canon</option>
        <option>Focus&fusion</option>
        <option>Konica Minolta</option>
        <option>Perlove</option>
        <option>Millensys</option>
        <option>IMS GIOTTO</option>
        <option>MEDECOM</option>
        <option>VILLA</option>
      </select>

      <label>Equipment Type:</label>
      <select id="equipmentType" required>
        <option value="">Select Type</option>
        <option>IRM</option>
        <option>Scanner</option>
        <option>Echographe</option>
        <option>Other</option>
      </select>

      <label>Model:</label>
      <select id="model" disabled required></select>

      <label>State / Wilaya:</label>
      <select id="state" required>
        <option value="">Select State</option>
        <option>Adrar</option><option>Chlef</option><option>Laghouat</option><option>Oum El Bouaghi</option>
        <option>Batna</option><option>Béjaïa</option><option>Biskra</option><option>Béchar</option>
        <option>Blida</option><option>Bouira</option><option>Tamanrasset</option><option>Tlemcen</option>
        <option>Tiaret</option><option>Tizi Ouzou</option><option>Algiers</option><option>Djelfa</option>
        <option>Jijel</option><option>Sétif</option><option>Skikda</option><option>Sidi Bel Abbes</option>
        <option>Annaba</option><option>Guelma</option><option>Constantine</option><option>Médéa</option>
        <option>Mostaganem</option><option>MSila</option><option>Mascara</option><option>Ouargla</option>
        <option>Oran</option><option>El Bayadh</option><option>Illizi</option><option>Bordj Bou Arréridj</option>
        <option>Boumerdès</option><option>El Tarf</option><option>Tindouf</option><option>Tissemsilt</option>
        <option>El Oued</option><option>Khenchela</option><option>Souk Ahras</option><option>Tipaza</option>
        <option>Mila</option><option>Ain Defla</option><option>Naama</option><option>Aïn Témouchent</option>
        <option>Ghardaïa</option><option>Relizane</option>
      </select>

      <label>Clinic or Hospital:</label>
      <input type="text" id="facility" required />

      <button type="submit">Add Installation</button>
    </form>

    <div id="map"></div>

    <h3>Recorded Installations</h3>
    <div id="entries" class="entry-list"></div>
  </div>
</div>

<script>
/* LOGIN */
const VALID_USERNAME = "admin";
const VALID_PASSWORD = "1234";

const loginContainer = document.getElementById("login-container");
const app = document.getElementById("app");

document.getElementById("loginForm").addEventListener("submit", e => {
  e.preventDefault();

  if (username.value === VALID_USERNAME && password.value === VALID_PASSWORD) {
    localStorage.setItem("loggedIn", "true");
    loginContainer.style.display = "none";
    app.style.display = "block";
    initMapApp();
  } else {
    alert("Invalid credentials");
  }
});

/* LOGOUT */
document.getElementById("logoutBtn").addEventListener("click", () => {
  localStorage.removeItem("loggedIn");
  loginContainer.style.display = "block";
  app.style.display = "none";
});

/* AUTO LOGIN */
window.addEventListener("load", () => {
  if (localStorage.getItem("loggedIn") === "true") {
    loginContainer.style.display = "none";
    app.style.display = "block";
    initMapApp();
  }
});

/* MODELS DATABASE */
const modelsData = {
  "Canon": {
    "Scanner": ["Aquilion", "Aquilion Lightling", "Aquilion Prime" , "Alexion"],
    "IRM": ["ELAN 1.5T", "ATLAS"],
    
  },
  "Focus&fusion": {
    "Echographe": ["Xario ", "Aplio A450" , "Cetus40"]
  },
  "Konicaminolta": {
    "Echographe": ["Xario ", "Aplio A450" , "Cetus40"]
  }
};

const brandSelect = document.getElementById("brand");
const equipmentTypeSelect = document.getElementById("equipmentType");
const modelSelect = document.getElementById("model");

brandSelect.addEventListener("change", updateModels);
equipmentTypeSelect.addEventListener("change", updateModels);

function updateModels() {
  const b = brandSelect.value;
  const t = equipmentTypeSelect.value;

  modelSelect.innerHTML = "";
  modelSelect.disabled = true;

  if (modelsData[b] && modelsData[b][t]) {
    modelSelect.disabled = false;
    modelsData[b][t].forEach(m => {
      let opt = document.createElement("option");
      opt.textContent = m;
      modelSelect.appendChild(opt);
    });
  }
}

/* MAP & INSTALLATIONS */
let map;
let markerCluster;
let installations = JSON.parse(localStorage.getItem("installations") || "[]");

const entriesDiv = document.getElementById("entries");

const stateCoords = {
  "Adrar":[27.87,-0.29],"Chlef":[36.17,1.33],"Laghouat":[33.80,2.88],"Oum El Bouaghi":[35.88,7.12],
  "Batna":[35.55,6.17],"Béjaïa":[36.75,5.06],"Biskra":[34.85,5.73],"Béchar":[31.61,-2.22],
  "Blida":[36.47,2.83],"Bouira":[36.38,3.90],"Tamanrasset":[22.79,5.52],"Tlemcen":[34.89,-1.32],
  "Tiaret":[35.37,1.32],"Tizi Ouzou":[36.71,4.05],"Algiers":[36.75,3.06],"Djelfa":[34.67,3.25],
  "Jijel":[36.82,5.77],"Sétif":[36.19,5.41],"Skikda":[36.88,6.91],"Sidi Bel Abbes":[35.19,-0.64],
  "Annaba":[36.90,7.76],"Guelma":[36.46,7.43],"Constantine":[36.36,6.61],"Médéa":[36.27,2.76],
  "Mostaganem":[35.93,0.09],"MSila":[35.70,4.55],"Mascara":[35.40,0.14],"Ouargla":[31.95,5.33],
  "Oran":[35.70,-0.63],"El Bayadh":[33.69,1.01],"Illizi":[26.51,8.48],"Bordj Bou Arréridj":[36.06,4.76],
  "Boumerdès":[36.77,3.48],"El Tarf":[36.77,8.30],"Tindouf":[27.67,-8.13],"Tissemsilt":[35.61,1.81],
  "El Oued":[33.37,6.86],"Khenchela":[35.43,7.15],"Souk Ahras":[36.28,7.95],"Tipaza":[36.60,2.45],
  "Mila":[36.45,6.26],"Ain Defla":[36.25,1.97],"Naama":[33.27,-0.31],"Aïn Témouchent":[35.30,-1.14],
  "Ghardaïa":[32.49,3.67],"Relizane":[35.73,0.55]
};

function initMapApp() {
  map = L.map("map").setView([28, 3], 5);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

  markerCluster = L.markerClusterGroup();
  map.addLayer(markerCluster);

  renderAll();

  document.getElementById("entryForm").addEventListener("submit", e => {
    e.preventDefault();

    let entry = {
      brand: brandSelect.value,
      equipmentType: equipmentTypeSelect.value,
      model: modelSelect.value,
      state: state.value,
      facility: facility.value.trim(),
    };

    installations.push(entry);
    localStorage.setItem("installations", JSON.stringify(installations));

    renderAll();
    e.target.reset();
    modelSelect.disabled = true;
  });
}

function addMarker(entry) {
  if (!stateCoords[entry.state]) return;

  let m = L.marker(stateCoords[entry.state]).bindPopup(
    `<b>${entry.facility}</b><br>
     ${entry.brand} - ${entry.equipmentType}<br>
     Model: ${entry.model}<br>
     ${entry.state}`
  );
  markerCluster.addLayer(m);
}

function renderAll() {
  entriesDiv.innerHTML = "";
  markerCluster.clearLayers();

  installations.forEach((e, i) => {
    addMarker(e);

    let div = document.createElement("div");
    div.className = "entry-item";
    div.innerHTML = `
      ${e.facility} — ${e.brand} ${e.model} (${e.state})
      <button class="delete-btn" onclick="deleteEntry(${i})">Delete</button>
    `;

    entriesDiv.appendChild(div);
  });
}

function deleteEntry(i) {
  installations.splice(i, 1);
  localStorage.setItem("installations", JSON.stringify(installations));
  renderAll();
}
</script>
</body>
</html>
